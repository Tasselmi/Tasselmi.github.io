<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="关于大数据、数据挖掘、数据可视化、机器学习、算法、集群、分布式计算 | LiangFan，Data Analyst & Big Data Lover | 这里是 @LiangFan梁凡 的个人博客，想和你们分享一切。">
    <meta name="keywords"  content="梁凡, LiangFan梁凡, LiangFan, 大数据, 数据挖掘, 数据分析, 数据可视化, 机器学习, 算法, 集群, 分布式计算, 函数式编程, python, dash, scala, numpy, pandas, plotly, clickhouse, @LiangFan, 梁凡的博客, LiangFan Blog, 博客, 个人网站, 互联网, Web">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Python Dash十讲之9 - 元素间数据交换 - 梁凡的博客 | LiangFan Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="设想如下1个需求：

  从数据库读取数据，数据量较大；然后将数据以Excel表格形式呈现在网页上
  数据表格可下载原始数据
  将其中部分数据或者全部数据以可视化图形方式呈现在网页上，需要呈现多个图形
  要求所有图形和表格按照一定频率定时自动刷新，下载的原始数据也必须是最新的数据

">
    
    <meta property="article:published_time" content="2018-12-10T19:00:00Z">
    
    
    <meta property="article:author" content="LiangFan">
    
    
    <meta property="article:tag" content="Python">
    
    <meta property="article:tag" content="Dash">
    
    <meta property="article:tag" content="数据可视化">
    
    
    <meta property="og:image" content="http://localhost:4000/img/me.JPG">
    <meta property="og:url" content="http://localhost:4000/2018/12/10/Python-Dash%E5%8D%81%E8%AE%B2%E4%B9%8B9-%E5%85%83%E7%B4%A0%E9%97%B4%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%8D%A2/">
    <meta property="og:site_name" content="梁凡的博客 | LiangFan Blog">
    
    <title>Python Dash十讲之9 - 元素间数据交换 - 梁凡的博客 | LiangFan Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/2018/12/10/Python-Dash%E5%8D%81%E8%AE%B2%E4%B9%8B9-%E5%85%83%E7%B4%A0%E9%97%B4%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%8D%A2/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">LiangFan's Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    
                    
                    
                    <li>
                        <a href="/about/">About Me</a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="/archive/">Archive</a>
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        <a href="/portfolio/">Portfolio</a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/my-post/07.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/my-post/07.jpg');
        background: ;
    }

    
</style>

<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=Python" title="Python">Python</a>
                        
                        <a class="tag" href="/archive/?tag=Dash" title="Dash">Dash</a>
                        
                        <a class="tag" href="/archive/?tag=%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96" title="数据可视化">数据可视化</a>
                        
                    </div>
                    <h1>Python Dash十讲之9 - 元素间数据交换</h1>
                    
                    <h2 class="subheading">————用hidden div来存储中间数据</h2>
                    <span class="meta">Posted by LiangFan on December 10, 2018</span>
                </div>
            </div>
        </div>
    </div>
</header>






<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<p>设想如下1个需求：</p>
<ul>
  <li>从数据库读取数据，数据量较大；然后将数据以Excel表格形式呈现在网页上</li>
  <li>数据表格可下载原始数据</li>
  <li>将其中部分数据或者全部数据以可视化图形方式呈现在网页上，需要呈现多个图形</li>
  <li>要求所有图形和表格按照一定频率定时自动刷新，下载的原始数据也必须是最新的数据</li>
</ul>

<blockquote>
  <p>需求分析：因为需要定时刷新，所以需要用到上面讲的监听 <code class="language-plaintext highlighter-rouge">n_intervals</code> 来实现（如果不监听<code class="language-plaintext highlighter-rouge">Interval</code>元素的 <code class="language-plaintext highlighter-rouge">n_intervals</code> 属性的话，那么读取数据并存为变量，只会在app启动的时候io一次，后面这个变量一直存储在内存中不会改变），每一个需要自动刷新的图形都要监听 <code class="language-plaintext highlighter-rouge">n_intervals</code> ；但是如果每个回调函数的input都是n_intervals的话，那么每个函数中都需要从数据库中读取数据，而这个数据量又非常大，如果每个函数都重复IO就非常耗时。因此需要转变解决问题的思路。</p>
</blockquote>

<p>1个可能的解决方案如下：</p>
<ul>
  <li>用一个div元素来存储中间数据，这个div的数据实现实时刷新，通过监听n_intervals来实现</li>
  <li>这个div元素设置为在前端不显示，只作为存储中间数据用</li>
  <li>这个div元素中的数据以json形式存储</li>
  <li>其它需要用到数据的元素从div元素中读取json，可以读取一部分或者全部读取，看使用需求情况</li>
  <li>div中的中间数据是基于用户当前浏览器会话的，不同用户间不共享，也就说每个用户打开页面都要IO一次数据，打开新的浏览器窗口也会重新IO一次数据</li>
  <li>该方案减少的是同一次会话中的重复IO时间，但是会增加不同回调函数间数据交换的时间，回调函数间的数据交换是通过网络传输实现的，因此会增加网络消耗</li>
</ul>

<p>代码示例如下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
</pre></td><td class="rouge-code"><pre><span class="c1"># -*- coding: utf-8 -*-
</span><span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">import</span> <span class="nn">dash_core_components</span> <span class="k">as</span> <span class="n">dcc</span>
<span class="kn">import</span> <span class="nn">dash_html_components</span> <span class="k">as</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">pymysql</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Output</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">State</span><span class="p">,</span> <span class="n">Event</span>
<span class="kn">import</span> <span class="nn">dash_table</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="p">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="p">.</span><span class="n">_create_unverified_context</span>

<span class="k">def</span> <span class="nf">select_mysql_data</span><span class="p">(</span><span class="n">db_config</span><span class="p">,</span> <span class="n">sql_sentence</span><span class="p">):</span>
    <span class="s">'''
    # 连接mysql数据库查询信息
    :param db_config:
    :param sql_sentence:
    :return:
    '''</span>
    <span class="c1"># 连接数据库
</span>    <span class="n">connection</span> <span class="o">=</span> <span class="n">pymysql</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">host</span><span class="o">=</span><span class="n">db_config</span><span class="p">[</span><span class="s">'host'</span><span class="p">],</span>
        <span class="n">user</span><span class="o">=</span><span class="n">db_config</span><span class="p">[</span><span class="s">'user'</span><span class="p">],</span>
        <span class="n">password</span><span class="o">=</span><span class="n">db_config</span><span class="p">[</span><span class="s">'password'</span><span class="p">],</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span>
        <span class="n">charset</span><span class="o">=</span><span class="s">'utf8'</span>
    <span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_sentence</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="n">description</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">connection</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">col_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'sql sentence matches no values.'</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="n">reports_mysql_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'host'</span><span class="p">:</span> <span class="s">'127.0.0.1'</span><span class="p">,</span>
    <span class="s">'user'</span><span class="p">:</span> <span class="s">'your-user'</span><span class="p">,</span>
    <span class="s">'password'</span><span class="p">:</span> <span class="s">'your-pwd'</span><span class="p">,</span>
    <span class="s">'port'</span><span class="p">:</span> <span class="s">'3306'</span><span class="p">,</span>
    <span class="s">'database'</span><span class="p">:</span> <span class="s">'db-name'</span><span class="p">,</span>
    <span class="s">'table'</span><span class="p">:</span> <span class="s">'tb-name'</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">sent</span> <span class="o">=</span> <span class="s">"SELECT * FROM {}.{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">reports_mysql_config</span><span class="p">[</span><span class="s">'database'</span><span class="p">]</span> <span class="p">,</span><span class="n">reports_mysql_config</span><span class="p">[</span><span class="s">'table'</span><span class="p">])</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="p">.</span><span class="n">Dash</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">app</span><span class="p">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">html</span><span class="p">.</span><span class="n">Div</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s">'div-store-data'</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s">'display'</span><span class="p">:</span> <span class="s">'none'</span><span class="p">}</span>
    <span class="p">),</span>
    <span class="n">dash_table</span><span class="p">.</span><span class="n">DataTable</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s">'data-table'</span><span class="p">,</span>
        <span class="n">style_as_list_view</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
            <span class="s">'backgroundColor'</span><span class="p">:</span> <span class="s">'#3D9970'</span><span class="p">,</span>
            <span class="s">'fontWeight'</span><span class="p">:</span> <span class="s">'bold'</span><span class="p">,</span>
            <span class="s">'textAlign'</span><span class="p">:</span> <span class="s">'center'</span><span class="p">,</span>
            <span class="s">'color'</span><span class="p">:</span> <span class="s">'white'</span><span class="p">,</span>
            <span class="s">'padding'</span><span class="p">:</span> <span class="mi">10</span>
        <span class="p">},</span>
        <span class="n">style_cell</span><span class="o">=</span><span class="p">{</span><span class="s">'textAlign'</span><span class="p">:</span> <span class="s">'center'</span><span class="p">},</span>
        <span class="n">pagination_settings</span><span class="o">=</span><span class="p">{</span>
            <span class="s">'current_page'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">'page_size'</span><span class="p">:</span> <span class="mi">15</span>  <span class="c1"># 每页行数
</span>        <span class="p">},</span>
        <span class="n">pagination_mode</span><span class="o">=</span><span class="s">'be'</span><span class="p">,</span>
        <span class="n">sorting</span><span class="o">=</span><span class="s">'be'</span><span class="p">,</span>
        <span class="n">sorting_type</span><span class="o">=</span><span class="s">'single'</span><span class="p">,</span>
        <span class="n">sorting_settings</span><span class="o">=</span><span class="p">[],</span>
    <span class="p">),</span>
    <span class="n">html</span><span class="p">.</span><span class="n">Div</span><span class="p">(</span>
       <span class="n">html</span><span class="p">.</span><span class="n">A</span><span class="p">(</span>
           <span class="s">'下载原始数据'</span><span class="p">,</span>
           <span class="nb">id</span><span class="o">=</span><span class="s">'download-link'</span><span class="p">,</span>
           <span class="n">download</span><span class="o">=</span><span class="s">"raw-data.csv"</span><span class="p">,</span>
           <span class="n">href</span><span class="o">=</span><span class="s">""</span><span class="p">,</span>
           <span class="n">target</span><span class="o">=</span><span class="s">"_blank"</span><span class="p">,</span>
           <span class="n">n_clicks</span><span class="o">=</span><span class="mi">0</span>
       <span class="p">),</span>
       <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s">'margin-top'</span><span class="p">:</span> <span class="mi">30</span><span class="p">}</span>
    <span class="p">),</span>
    <span class="n">dcc</span><span class="p">.</span><span class="n">Interval</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s">'interval-component'</span><span class="p">,</span>
        <span class="n">interval</span><span class="o">=</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span>   <span class="c1"># in milliseconds / refresh the web-page in every 60 minutes
</span>        <span class="n">n_intervals</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">),</span>
    <span class="n">html</span><span class="p">.</span><span class="n">Div</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s">'listen-download-link'</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s">'display'</span><span class="p">:</span> <span class="s">'none'</span><span class="p">}</span>
    <span class="p">)</span>
<span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s">'margin-left'</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s">'margin-right'</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s">'margin-top'</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>

<span class="c1"># 监听n_intervals，实现数据自动刷新，并将新数据存入一个hidden的div中
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s">'div-store-data'</span><span class="p">,</span> <span class="s">'children'</span><span class="p">),</span> <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s">'interval-component'</span><span class="p">,</span> <span class="s">'n_intervals'</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_and_store_data</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">channelDailyData</span> <span class="o">=</span> <span class="n">select_mysql_data</span><span class="p">(</span><span class="n">reports_mysql_config</span><span class="p">,</span> <span class="n">sent</span><span class="p">).</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">'日期'</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">channelDailyData</span><span class="p">[</span><span class="s">'日期'</span><span class="p">]</span> <span class="o">=</span> <span class="n">channelDailyData</span><span class="p">[</span><span class="s">'日期'</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">channelDailyData</span><span class="p">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s">'split'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s">'download-link'</span><span class="p">,</span> <span class="s">'href'</span><span class="p">),</span> <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s">'div-store-data'</span><span class="p">,</span> <span class="s">'children'</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_download_link</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s">'split'</span><span class="p">)</span>
    <span class="n">csv_string</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span>
    <span class="n">csv_string</span> <span class="o">=</span> <span class="s">"data:text/csv;charset=utf-8,"</span> <span class="o">+</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">csv_string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">csv_string</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s">'data-table'</span><span class="p">,</span> <span class="s">'columns'</span><span class="p">),</span> <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s">'div-store-data'</span><span class="p">,</span> <span class="s">'children'</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">update_table</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s">'split'</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[{</span><span class="s">'id'</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="n">c</span><span class="p">}</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">]</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s">'data-table'</span><span class="p">,</span> <span class="s">'data'</span><span class="p">),</span>
    <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s">'data-table'</span><span class="p">,</span> <span class="s">'pagination_settings'</span><span class="p">),</span> <span class="n">Input</span><span class="p">(</span><span class="s">'data-table'</span><span class="p">,</span> <span class="s">'sorting_settings'</span><span class="p">),</span>
     <span class="n">Input</span><span class="p">(</span><span class="s">'div-store-data'</span><span class="p">,</span> <span class="s">'children'</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">update_graph</span><span class="p">(</span><span class="n">pagination_settings</span><span class="p">,</span> <span class="n">sorting_settings</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s">'split'</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorting_settings</span><span class="p">):</span>
        <span class="n">dff</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="n">sorting_settings</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">'column_id'</span><span class="p">],</span>
            <span class="n">ascending</span><span class="o">=</span><span class="n">sorting_settings</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">'direction'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'asc'</span><span class="p">,</span>
            <span class="n">inplace</span><span class="o">=</span><span class="bp">False</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># No sort is applied
</span>        <span class="n">dff</span> <span class="o">=</span> <span class="n">df</span>

    <span class="k">return</span> <span class="n">dff</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span>
        <span class="n">pagination_settings</span><span class="p">[</span><span class="s">'current_page'</span><span class="p">]</span><span class="o">*</span><span class="n">pagination_settings</span><span class="p">[</span><span class="s">'page_size'</span><span class="p">]:</span>
        <span class="p">(</span><span class="n">pagination_settings</span><span class="p">[</span><span class="s">'current_page'</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pagination_settings</span><span class="p">[</span><span class="s">'page_size'</span><span class="p">]</span>
    <span class="p">].</span><span class="n">to_dict</span><span class="p">(</span><span class="s">'rows'</span><span class="p">)</span>

<span class="c1"># 监听是否有人下载了数据
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s">'listen-download-link'</span><span class="p">,</span> <span class="s">'children'</span><span class="p">),</span> <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s">'download-link'</span><span class="p">,</span> <span class="s">'n_clicks'</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">listen_download_link</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">{}  someone download data in {} times.'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8050</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p> 
 </p>



                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2018/12/10/Python-Dash%E5%8D%81%E8%AE%B2%E4%B9%8B8-%E5%A4%9A%E9%A1%B5DASH-APP/" data-toggle="tooltip" data-placement="top" title="Python Dash十讲之8 - 多页DASH APP">
                        Previous<br>
                        <span>Python Dash十讲之8 - 多页DASH APP</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2018/12/10/Python-Dash%E5%8D%81%E8%AE%B2%E4%B9%8B10-%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98%E5%8F%8A%E4%BF%A1%E5%8F%B7%E5%8F%91%E9%80%81/" data-toggle="tooltip" data-placement="top" title="Python Dash十讲之10 - 数据缓存及信号发送">
                        Next<br>
                        <span>Python Dash十讲之10 - 数据缓存及信号发送</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

                
            </div>  

    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        </a>
        
        
                <a data-sort="0014" 
                    href="/archive/?tag=Python"
                    title="Python"
                    rel="11">Python</a>
        
                <a data-sort="0015" 
                    href="/archive/?tag=%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96"
                    title="数据可视化"
                    rel="10">数据可视化</a>
        
                <a data-sort="0015" 
                    href="/archive/?tag=Dash"
                    title="Dash"
                    rel="10">Dash</a>
        
                <a data-sort="0019" 
                    href="/archive/?tag=%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99"
                    title="个人网站"
                    rel="6">个人网站</a>
        
                <a data-sort="0019" 
                    href="/archive/?tag=jekyll"
                    title="jekyll"
                    rel="6">jekyll</a>
        
                <a data-sort="0020" 
                    href="/archive/?tag=%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8"
                    title="阿里云服务器"
                    rel="5">阿里云服务器</a>
        
                <a data-sort="0021" 
                    href="/archive/?tag=Tomcat"
                    title="Tomcat"
                    rel="4">Tomcat</a>
        
                <a data-sort="0022" 
                    href="/archive/?tag=ClickHouse"
                    title="ClickHouse"
                    rel="3">ClickHouse</a>
        
                <a data-sort="0022" 
                    href="/archive/?tag=OLAP"
                    title="OLAP"
                    rel="3">OLAP
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="http://mida.re/">乱序</a></li>
  
  <li><a href="http://lingyu.wang/">天镶的博客</a></li>
  
  <li><a href="http://hmqk1995.github.io">Luke 的自留地</a></li>
  
  <li><a href="http://ebnbin.com/">Ebn's Blog</a></li>
  
  <li><a href="http://blog.smdcn.net">SmdCn's Blog</a></li>
  
</ul>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->






<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "liangfan";
    var disqus_identifier = "/2018/12/10/Python Dash十讲之9-元素间数据交换";
    var disqus_url = "http://localhost:4000/2018/12/10/Python-Dash%E5%8D%81%E8%AE%B2%E4%B9%8B9-%E5%85%83%E7%B4%A0%E9%97%B4%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%8D%A2/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->






    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  <li>
    <a href="https://twitter.com/DreamAsHorse">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  
  
  <li>
    <a target="_blank" href="https://github.com/tasselmi">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; LiangFan's Blog 2020
                    <br>
                    Powered by <a href="http://huangxuan.me">Hux Blog</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->





<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-130482639-1';
    var _gaDomain = 'liangfan.tech';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = 'd93bdd58f8335d1b868c1536fbaba623';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>



<!-- Side Catalog -->



<!-- Multi-Lingual -->




<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
